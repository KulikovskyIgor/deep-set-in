'use strict';function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var cloneDeep=require('clone-deep'),kindOf=require('kind-of');module.exports=function(b,c,d,e){return _validateAttrs.call(this,b,c,d,e),_set.call(this,b,c,d,e)};function _validateAttrs(a,b,c,d){if('object'!==kindOf(a))throw new Error('First argument must be an object');if('array'!==kindOf(b))throw new Error('Second argument must be an array');else if(!b.length)throw new Error('Path must not be empty');if(!c)throw new Error('Value must be specified');if(d&&'object'!==kindOf(d))throw new Error('Options must be an object')}function _set(a,b,c,d){for(var e=_getRootObj(a,d),f=e,g=0;g<b.length;g++)if(_manageCreateEntity(f,b[g],d),'string'===kindOf(b[g])){if(!f.hasOwnProperty(b[g]))return;if(g+1===b.length)return f[b[g]]=c,e;f=f[b[g]]}else if('array'===kindOf(b[g])){var h=b[g][0],j=b[g][1],k=b[g][2];if(!f.hasOwnProperty(h)||'array'!==kindOf(f[h]))return;var l=_findIndex(f[h],j,k);if('number'!==kindOf(l))return;if(g+1===b.length)return f[h][l]=c,e;f=f[h][l]}}function _findIndex(a,b,c){for(var d=0;d<a.length;d++)if('object'===kindOf(a[d])&&a[d].hasOwnProperty(b)&&a[d][b]===c)return d}function _getRootObj(a,b){return b&&b.immutable?cloneDeep(a):a}function _manageCreateEntity(a,b,c){if(!(c&&c.create))return a;else if('string'===kindOf(b))a.hasOwnProperty(b)||(a[b]={});else if('array'===kindOf(b)){var d=b[0],e=b[1],f=b[2];a.hasOwnProperty(d)&&'array'===kindOf(a[d])||(a[d]=[]);var g=_findIndex(a[d],e,f);'number'!==kindOf(g)&&a[d].push(_defineProperty({},e,f))}}